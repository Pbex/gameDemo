{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Boss/assets\\Scripts\\Boss\\AI.js"],"names":["movingLeft","movingWidth","coolDownTimer","cc","Class","extends","Component","properties","gameManager","Node","player","doingSth","canvas","bullet","Prefab","coolDownTime","chargingTime","chargingCurvRate","bulletSpeed","speed","moveDown","xBias","node","position","x","finished","callFunc","mov","anim","getComponent","Animation","play","lastPos","moveBackAction","moveTo","easing","easeElasticOut","target","moveDownAction","easeOut","seq","sequence","runAction","moveHorizontal","dt","Vec2","y","initPos","initialPos","v2","height","movingLogic","generateSingleBullet","direction","yBias","newBullet","instantiate","addChild","setPosition","width","switchDir","maxX","maxY","generateBullets","bias","skillChoice","maxVal","minVal","choice","Math","floor","random","onLoad","onEnable","start","update"],"mappings":"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","file":"AI.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Boss","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar movingLeft = true;\r\nvar movingWidth = 0;\r\nvar coolDownTimer = 0;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        gameManager:cc.Node,\r\n        player: cc.Node,\r\n        doingSth: false,\r\n        canvas: cc.Node,\r\n        bullet: cc.Prefab,\r\n        coolDownTime: 5,//boss skill have cool down time, not continueously\r\n        chargingTime: 2,//the time cost of charging or moving back\r\n        chargingCurvRate: 2,//doingSth is running according to a curve certian rate\r\n        bulletSpeed:150,\r\n        speed: 100,//the horizon moving speed of boss\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    moveDown() {\r\n        var xBias = this.node.position.x - this.player.position.x;\r\n        if (xBias < 10 && xBias > -10) {\r\n            this.doingSth = true;\r\n            var finished = cc.callFunc(function (mov) {\r\n                this.doingSth = false;\r\n                var anim = this.getComponent(cc.Animation);\r\n                anim.play('idle');\r\n            }, this, false);\r\n\r\n            var lastPos = this.node.position;\r\n            var moveBackAction = cc.moveTo(this.chargingTime, lastPos);\r\n            moveBackAction.easing(cc.easeElasticOut(this.chargingCurvRate));\r\n\r\n            var target = this.player.position;\r\n            var moveDownAction = cc.moveTo(this.chargingTime, target);\r\n            moveDownAction.easing(cc.easeOut(this.chargingCurvRate));\r\n\r\n            var seq = cc.sequence(moveDownAction, moveBackAction, finished);\r\n\r\n            this.node.runAction(seq);\r\n\r\n            var anim = this.getComponent(cc.Animation);\r\n            anim.play('charge');\r\n        }\r\n    },\r\n\r\n    moveHorizontal(dt) {\r\n        // console.log(dt * this.speed);\r\n        // console.log(movingLeft);\r\n        // console.log(this.node.position.x);\r\n\r\n\r\n        if (movingLeft) {\r\n            this.node.position = new cc.Vec2(this.node.position.x - (dt * this.speed),\r\n                this.node.position.y);\r\n        } else {\r\n            this.node.position = new cc.Vec2(this.node.position.x + (dt * this.speed),\r\n                this.node.position.y);\r\n        }\r\n\r\n        if (this.node.position.x > movingWidth) {\r\n            movingLeft = true;\r\n        }\r\n        else if (this.node.position.x < -movingWidth) {\r\n            movingLeft = false;\r\n        }\r\n    },\r\n\r\n    initPos() {\r\n        this.doingSth = true;\r\n        var initialPos = cc.v2(this.node.position.x, this.canvas.height / 2);\r\n        var finished = cc.callFunc(function (mov) {\r\n            this.doingSth = false;\r\n        }, this, false);\r\n        var seq = cc.sequence(cc.moveTo(2, initialPos), finished);\r\n        this.node.runAction(seq);\r\n    },\r\n\r\n    movingLogic(dt) {\r\n        this.moveHorizontal(dt);\r\n        this.moveDown();\r\n    },\r\n    generateSingleBullet(direction, yBias) {\r\n        // console.log('bullet Direction: '+direction);\r\n        // console.log('bullet y pos: '+this.player.position.y);\r\n        // console.log('bullet x pos: '+this.canvas.width/2);\r\n        var newBullet = cc.instantiate(this.bullet);\r\n        this.canvas.addChild(newBullet);\r\n        if (direction == 1) {//see Bullet.js, comes from right\r\n            newBullet.setPosition(cc.v2(this.canvas.width/2, this.player.position.y + yBias));\r\n        } else {//see Bullet.js, comes from left(3)\r\n            newBullet.setPosition(cc.v2(-this.canvas.width/2, this.player.position.y + yBias));\r\n        }\r\n        newBullet.getComponent('Bullet').direction = direction;\r\n        newBullet.getComponent('Bullet').gameManager=this.gameManager;\r\n        newBullet.getComponent('Bullet').switchDir();\r\n        newBullet.getComponent('Bullet').speed = this.bulletSpeed;\r\n        newBullet.getComponent('Bullet').maxX = this.canvas.width;\r\n        newBullet.getComponent('Bullet').maxY = this.canvas.height;\r\n        \r\n    },\r\n    generateBullets() {\r\n        var anim = this.getComponent(cc.Animation);\r\n        anim.play('charge');\r\n        for (let bias = -120; bias < 121; bias+=60) {\r\n            this.generateSingleBullet(1,bias);\r\n            this.generateSingleBullet(3,bias);\r\n        }\r\n        this.doingSth = false;\r\n    },\r\n\r\n    skillChoice(dt) {\r\n        if (coolDownTimer > this.coolDownTime) {\r\n            this.doingSth = true;\r\n            var maxVal = 1;\r\n            var minVal = 0;\r\n            var choice = Math.floor((Math.random() + 0.5) * (maxVal - minVal));\r\n            switch (choice) {\r\n                case 0:\r\n                    this.generateBullets();\r\n                    break;\r\n\r\n                default:\r\n                    this.doingSth = false;\r\n                    break;\r\n            }\r\n            coolDownTimer=0;\r\n        }\r\n        coolDownTimer += dt;\r\n    },\r\n\r\n    onLoad() {\r\n        var anim = this.getComponent(cc.Animation);\r\n        anim.play('idle');\r\n        movingWidth = this.canvas.width / 2;\r\n        // movingWidth = this.canvas.width / 2 - this.node.width / 2;\r\n    },\r\n\r\n    //node active action\r\n    onEnable() {\r\n        this.initPos();\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    update(dt) {\r\n        // console.log(this.doingSth);\r\n        if (this.doingSth) {//can't use other logic while doing something\r\n\r\n        } else {\r\n            this.movingLogic(dt);\r\n            this.skillChoice(dt);\r\n        }\r\n\r\n    },\r\n});\r\n"]}