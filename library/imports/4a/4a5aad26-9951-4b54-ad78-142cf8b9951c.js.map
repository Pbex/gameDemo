{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\GameLogic.js"],"names":["bulletTimer","directionTimer","counter","bulletDirection","playerBulletTimer","playerBulletTime","singleBulletTimer","singleBulletTime","bulletShooted","isShooting","skillChance","cc","Class","extends","Component","properties","gameManager","default","type","Node","slowStone","Prefab","normalStone","fastStone","player","playerBullet","bulletNum","skillActor","directionSwapTime","bulletSpeed","bulletGenerateTime","skillChoiceUI","radar","boss","bossGenerateTime","generateBullets","addSpeed","generateRandomPos","randX","randY","Math","random","node","width","height","v2","spawnNewBullets","speedUp","newBullet","instantiate","addChild","setPosition","getComponent","direction","switchDir","speed","maxX","maxY","console","log","stopBulletGeneration","startBulletGeneration","bulletGenerator","dt","skillChoice","active","generateBullet","position","moveBullet","startShooting","stopShooting","bossActive","getGameTime","activeRadar","getBullet","closeRadar","setGameTime","onLoad","update"],"mappings":"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","file":"GameLogic.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar bulletTimer = 0;\r\nvar directionTimer = 0;\r\nvar counter = 0;\r\nvar bulletDirection = 0;\r\nvar playerBulletTimer=0;\r\nvar playerBulletTime=0.7;\r\nvar singleBulletTimer=0;\r\nvar singleBulletTime=0.1;\r\nvar bulletShooted=0;\r\nvar isShooting=false;\r\nvar skillChance=true;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        gameManager: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n\r\n\r\n        slowStone: cc.Prefab,\r\n        normalStone: cc.Prefab,\r\n        fastStone: cc.Prefab,\r\n\r\n        player: cc.Node,\r\n        playerBullet:cc.Prefab,\r\n        bulletNum:1,\r\n        skillActor: cc.Node,\r\n\r\n        directionSwapTime: 30,\r\n        bulletSpeed: 1,\r\n        bulletGenerateTime: 1,\r\n\r\n        skillChoiceUI: cc.Node,\r\n        radar: cc.Node,\r\n        boss: cc.Node,\r\n        bossGenerateTime: 100,\r\n\r\n        generateBullets: true,\r\n    },\r\n\r\n    addSpeed() {\r\n        this.bulletGenerateTime *= 0.85;\r\n    },\r\n\r\n    generateRandomPos: function () {\r\n        var randX = 0;\r\n        var randY = 0;\r\n        switch (bulletDirection) {\r\n            case 0://bullets come from up\r\n                randX = (Math.random() - 0.5) * this.node.width;\r\n                randY = this.node.height / 2;\r\n                break;\r\n            case 1://bullets come from right\r\n                randX = this.node.width / 2;\r\n                randY = (Math.random() - 0.5) * this.node.height;\r\n                break;\r\n            case 2://bullets come from down\r\n                randX = (Math.random() - 0.5) * this.node.width;\r\n                randY = -this.node.height / 2;\r\n                break;\r\n            case 3://bullets come from left\r\n                randX = -this.node.width / 2;\r\n                randY = (Math.random() - 0.5) * this.node.height;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        return cc.v2(randX, randY);\r\n    },\r\n\r\n    spawnNewBullets: function (speedUp) {\r\n        switch (speedUp) {\r\n            case 4:\r\n                var newBullet = cc.instantiate(this.fastStone);\r\n                break;\r\n            case 2:\r\n                var newBullet = cc.instantiate(this.normalStone);\r\n                break;\r\n            case 1:\r\n                var newBullet = cc.instantiate(this.slowStone);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        this.node.addChild(newBullet);//add node to canvas\r\n        newBullet.setPosition(this.generateRandomPos());\r\n        newBullet.getComponent('Bullet').direction = bulletDirection;\r\n        newBullet.getComponent('Bullet').gameManager = this.gameManager;\r\n        newBullet.getComponent('Bullet').switchDir();\r\n        newBullet.getComponent('Bullet').speed = this.bulletSpeed * speedUp;\r\n        newBullet.getComponent('Bullet').maxX = this.node.width;\r\n        newBullet.getComponent('Bullet').maxY = this.node.height;\r\n        \r\n        console.log('spwan bullet done');\r\n        \r\n    },\r\n\r\n    stopBulletGeneration() {\r\n        this.generateBullets = false;\r\n    },\r\n    startBulletGeneration() {\r\n        this.generateBullets = true;\r\n    },\r\n\r\n    bulletGenerator(dt) {\r\n        if (directionTimer > this.directionSwapTime) {\r\n            // console.log('direction changed');\r\n\r\n            bulletDirection++;\r\n            directionTimer = 0;\r\n            bulletDirection %= 4;\r\n            this.addSpeed();\r\n        }\r\n        if (bulletTimer > this.bulletGenerateTime) {\r\n            bulletTimer = 0;\r\n            if (counter < 4) {\r\n                this.spawnNewBullets(4);\r\n            } else if (counter < 7) {\r\n                this.spawnNewBullets(2);\r\n            } else {\r\n                this.spawnNewBullets(1);\r\n            }\r\n            counter++;\r\n            counter %= 10;\r\n        }\r\n        bulletTimer += dt;\r\n        directionTimer += dt;\r\n    },\r\n\r\n    //todo\r\n    skillChoice() {\r\n        this.skillChoiceUI.active = true;\r\n        this.skillChoiceUI.getComponent('SkillManager').gameManager=this;\r\n        //the activation of boss and shooting execute by skill manager\r\n        // this.boss.active = true;\r\n        // this.skillActor.getComponent('SkillActor').startShooting();\r\n    },\r\n    generateBullet(dt){\r\n        playerBulletTimer += dt;\r\n        singleBulletTimer+=dt;\r\n        \r\n        if (playerBulletTimer > playerBulletTime) {\r\n            if (singleBulletTimer>singleBulletTime) {\r\n                var newBullet = cc.instantiate(this.playerBullet);\r\n                this.node.addChild(newBullet);\r\n                newBullet.setPosition(this.player.position);\r\n                newBullet.getComponent('PlayerBullet').moveBullet(this.boss.position);\r\n                bulletShooted++;\r\n                singleBulletTimer=0;\r\n                if (bulletShooted==this.bulletNum) {\r\n                    playerBulletTimer=0;\r\n                    bulletShooted=0;\r\n                }\r\n            }\r\n\r\n        }\r\n    },\r\n    startShooting(){\r\n        this.isShooting=true;\r\n    },\r\n    stopShooting(){\r\n        this.isShooting=false;\r\n    },\r\n    bossActive() {\r\n        \r\n        if (this.gameManager.getComponent('GameManager').getGameTime() > this.bossGenerateTime) {\r\n            \r\n            this.stopBulletGeneration();\r\n            this.activeRadar();\r\n            // if (this.gameManager.getComponent('GameManager').getBullet() <= 0) {\r\n            //     this.skillChoice();\r\n            // }\r\n            if (skillChance&&this.gameManager.getComponent('GameManager').getBullet()<10) {\r\n                this.closeRadar();\r\n                this.skillChoice();\r\n                skillChance=false;\r\n                this.gameManager.getComponent('GameManager').setGameTime(0);\r\n            }\r\n        }\r\n    },\r\n    activeRadar(){\r\n        this.radar.active=true;\r\n    },\r\n    closeRadar(){\r\n        this.radar.active=!this.radar.active;\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n\r\n    },\r\n\r\n    // start () {\r\n\r\n    // },\r\n\r\n    update(dt) {\r\n        if (this.generateBullets) {\r\n            this.bulletGenerator(dt);\r\n        }\r\n        this.bossActive();\r\n        if (this.isShooting) {\r\n            this.generateBullet(dt);\r\n        }\r\n    },\r\n});\r\n"]}