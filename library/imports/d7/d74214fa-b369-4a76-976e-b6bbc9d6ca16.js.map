{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\JoyStick.js"],"names":["cc","Class","extends","Component","properties","stick","type","Node","default","max_r","stopMoving","onLoad","start_pos","v2","setPosition","dir","on","EventType","TOUCH_START","bind","TOUCH_MOVE","e","w_pos","getLocation","pos","node","convertToNodeSpaceAR","len","mag","x","y","TOUCH_END","TOUCH_CANCEL","start"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,eAAM;AACFC,kBAAMN,GAAGO,IADP;AAEFC,qBAAS;AAFP,SAhBE;AAoBRC,eAAQ,EApBA;AAqBRC,oBAAW;AArBH,KAHP;;AA2BL;;AAEAC,UA7BK,oBA6BK;AACN,aAAKC,SAAL,GAAiBZ,GAAGa,EAAH,CAAM,CAAN,EAAS,CAAT,CAAjB;AACA,aAAKR,KAAL,CAAWS,WAAX,CAAuB,KAAKF,SAA5B;;AAEA,aAAKG,GAAL,GAAWf,GAAGa,EAAH,CAAM,CAAN,EAAS,CAAT,CAAX;;AAEA,aAAKR,KAAL,CAAWW,EAAX,CAAchB,GAAGO,IAAH,CAAQU,SAAR,CAAkBC,WAAhC,EAA6C,YAAU,CAEtD,CAF4C,CAE3CC,IAF2C,CAEtC,IAFsC,CAA7C,EAEc,IAFd;;AAIA,aAAKd,KAAL,CAAWW,EAAX,CAAchB,GAAGO,IAAH,CAAQU,SAAR,CAAkBG,UAAhC,EAA4C,UAASC,CAAT,EAAW;AACnD,iBAAKX,UAAL,GAAgB,KAAhB;AACA,gBAAIY,QAAQD,EAAEE,WAAF,EAAZ;AACA,gBAAIC,MAAM,KAAKC,IAAL,CAAUC,oBAAV,CAA+BJ,KAA/B,CAAV;AACA,gBAAIK,MAAMH,IAAII,GAAJ,EAAV;;AAEA;;;;;;AAMA,iBAAKb,GAAL,CAASc,CAAT,GAAaL,IAAIK,CAAJ,GAAQF,GAArB;AACA,iBAAKZ,GAAL,CAASe,CAAT,GAAaN,IAAIM,CAAJ,GAAQH,GAArB;;AAIA,gBAAGA,MAAM,KAAKlB,KAAd,EAAoB;AAChB;AACAe,oBAAIK,CAAJ,GAAQL,IAAIK,CAAJ,GAAQ,KAAKpB,KAAb,GAAqBkB,GAA7B;AACAH,oBAAIM,CAAJ,GAAQN,IAAIM,CAAJ,GAAQ,KAAKrB,KAAb,GAAqBkB,GAA7B;AACH;AACD,iBAAKtB,KAAL,CAAWS,WAAX,CAAuBU,GAAvB;AAEH,SAxB2C,CAwB1CL,IAxB0C,CAwBrC,IAxBqC,CAA5C,EAwBc,IAxBd;;AA0BA,aAAKd,KAAL,CAAWW,EAAX,CAAchB,GAAGO,IAAH,CAAQU,SAAR,CAAkBc,SAAhC,EAA2C,YAAU;AACjD;AACA;AACA,iBAAK1B,KAAL,CAAWS,WAAX,CAAuB,KAAKF,SAA5B;AACA,iBAAKF,UAAL,GAAgB,IAAhB;AACH,SAL0C,CAKzCS,IALyC,CAKpC,IALoC,CAA3C,EAKc,IALd;;AAOA,aAAKd,KAAL,CAAWW,EAAX,CAAchB,GAAGO,IAAH,CAAQU,SAAR,CAAkBe,YAAhC,EAA8C,YAAU;AACpD;AACA,iBAAK3B,KAAL,CAAWS,WAAX,CAAuB,KAAKF,SAA5B;AACA,iBAAKF,UAAL,GAAgB,IAAhB;AACH,SAJ6C,CAI5CS,IAJ4C,CAIvC,IAJuC,CAA9C,EAIc,IAJd;AAKH,KA7EI;AA+ELc,SA/EK,mBA+EI,CAER;AAjFI;;AAmFL;AAnFJ","file":"JoyStick.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        stick:{\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n        max_r : 80,\r\n        stopMoving:true,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.start_pos = cc.v2(0, 0);\r\n        this.stick.setPosition(this.start_pos);\r\n\r\n        this.dir = cc.v2(0, 0);\r\n\r\n        this.stick.on(cc.Node.EventType.TOUCH_START, function(){\r\n\r\n        }.bind(this), this);\r\n\r\n        this.stick.on(cc.Node.EventType.TOUCH_MOVE, function(e){\r\n            this.stopMoving=false;\r\n            var w_pos = e.getLocation();\r\n            var pos = this.node.convertToNodeSpaceAR(w_pos);\r\n            var len = pos.mag();\r\n\r\n            /* 好处\r\n            归一化，一个方向，只有一个值;\r\n            this.dir.x = cos(r);\r\n            this.dir.y = sin(r);\r\n            // -1, 1\r\n            */\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n\r\n\r\n\r\n            if(len > this.max_r){\r\n                // 三角函数或者比例关系算坐标\r\n                pos.x = pos.x * this.max_r / len;\r\n                pos.y = pos.y * this.max_r / len;\r\n            }\r\n            this.stick.setPosition(pos);\r\n\r\n        }.bind(this), this);\r\n\r\n        this.stick.on(cc.Node.EventType.TOUCH_END, function(){\r\n            //方向最后不矫正了,会有强制矫正方向的问题\r\n            // this.dir = cc.v2(0, 0);\r\n            this.stick.setPosition(this.start_pos);\r\n            this.stopMoving=true;\r\n        }.bind(this), this);\r\n\r\n        this.stick.on(cc.Node.EventType.TOUCH_CANCEL, function(){\r\n            // this.dir = cc.v2(0, 0);\r\n            this.stick.setPosition(this.start_pos);\r\n            this.stopMoving=true;\r\n        }.bind(this), this);\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n});"]}